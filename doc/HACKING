# Hacking on HALT

First, make the virtual disk.

    ./script/make_disk

Mount this disk in loop so that you can write to a plain folder to write to the disk.

    ./script/mount

Then, build and deploy the uefi bootloader and HALT.

    ./script/all

Use qemu to  boot it all up:

    ./script/qemu_bios  # You only need to run it once
    ./script/qemu

Happy hacking!

## Qemu

In order to run the image with Qemu, use http://sourceforge.net/apps/mediawiki/tianocore/index.php?title=OVMF. Rename OVMF.fd to bios.bin, and CirrusLogic5446.rom to vgabios-cirrus.bin. Put them both in qemu-bios.

Run with

    make qemu

### GDB in qemu

Based heavily on http://wiki.osdev.org/UEFI#Using_GNU_toolchain_for_compiling_and_debugging_EFI_applications

First, create the debug boot loader.

    cd uefi_bootloader/
    make debug

Run with

    QEMU_DEBUG_OPTIONS="-s -S" ./script/qemu

In another tab, run

    gdb -x etc/gdb/qemu-debug.gdb

This sets up a gdb that connects to qemu for remote debugging. Type "continue" to make qemu continue loading.

## GCC

There is a gotcha. You need gcc >= 4.7, otherwise the `-DGNU_EFI_USE_MS_ABI` flag won't work and the calls to BootServices will end up with errors.